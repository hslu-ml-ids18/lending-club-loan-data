---
title: "Data_Preparation"
author: "L. Becker, A. Chebatarova, A. Kandel, A.Kusche, R. Mizrak"
date: "5/13/2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!-- ```{r Data Loading} -->
<!-- # we load the loan file and select lineitems that fit our group number 7 -->
<!-- # we might move this somewhere else and use only the prepared csv as this is time consuming -->

<!-- loan_df <- read.csv(file = "loan.csv", header = TRUE) -->
<!-- loan_df <- cbind(id_2 = rownames(loan_df), loan_df) -->
<!-- rownames(loan_df) <- 1:nrow(loan_df) -->
<!-- loan_df$id_2 <- as.numeric(loan_df$id_2) -->
<!-- dataset_7 <- loan_df[which(loan_df$id_2%%8+1== 7),] -->
<!-- ``` -->

<!-- ```{r Saving dataset as rds} -->

<!-- # Write RDS in R -->

<!-- # saveRDS(dataset_7, file = "dataset_7.Rds") -->
<!-- ``` -->

```{r loading Rds file}
dataset_7 <- read_rds("dataset_7.Rds")
```

```{r Data Preparation NAs removal}
# Given we want to do a regression analysis we want to change boolean string values to numeric ones.
# Omiting columns that only have NAs, ie. id and member_id.
dataset <- dataset_7[,colSums(is.na(dataset_7))<nrow(dataset_7)]

# changing the dataset as a tbl object.
dataset <- as.tbl(dataset)
# change NAs to 0 in integer columns
dataset <- mutate_if(dataset, is.integer, ~replace(., is.na(.), 0))
# change NAs to 0 in doubles columns

dataset <- mutate_if(dataset, is.numeric, ~replace(., is.na(.), 0))
# change NAs to 0 in strings columns

dataset <- mutate_if(dataset, is.character, ~replace(., is.na(.), 0))

# calculating the number of unique levels per column
sapply(dataset, function(col) length(unique(col)))

#removing dataset_7
rm(dataset_7)

# changing emp_title from integer to string
emp_title <- toString(emp_title)

# changing emp_title "" values to "unknown"
emp_title[emp_title == ""] <- "Unknown"

# # attaching the cleaned dataset
# attach(dataset)

```

<!-- ```{r removing column that have many NAs} -->
<!-- # from ILIAS FROM "New dataset version - issue with mainly NA predictors" -->
<!-- dataset <- as_tibble(dataset) -->
<!-- newdataset <- dataset[lapply(dataset , function(x) sum(is.na(x)) / length(x) ) < 0.05 ] %>% as_tibble() -->

<!-- ``` -->

```{r Data Cleaning emp_title}
# changing emp_title to a factor
dataset$emp_title <- as.vector(dataset$emp_title)
# Replacing empting values in emp_title to 'No Title'
dataset$emp_title <- sub("^$", "No Title", dataset$emp_title)

```

```{r Data Cleaning hardship_type}
# changing emp_title type
dataset$hardship_type <- as.character(dataset$hardship_type)
# Replacing empting values in hardship_type to '0'
dataset$hardship_type <- sub("No deferral", "0", dataset$hardship_type)
# Replacing '' values in hardship_type to '0'
dataset$hardship_type <- sub("INTEREST ONLY-3 MONTHS DEFERRAL", "1", dataset$hardship_type)
```